#!/usr/bin/env coffee

# Copyright (c) 2014 Michele Bini

# MIT license

[ progname, args ] = do->
  { argv } = process
  args = argv.slice(0)
  args.shift() if /([/]|^)coffee([.].*)?$/.test args[0]
  progname = args.shift()
  [ progname, args ]

{ stdin, stdout, stderr } = process

fs = require "fs"

print = (x)-> fs.writeSync 1, "#{x}"
echo = (x)-> fs.writeSync 1, "#{x}\n"
log = (x)-> stderr.write "#{x}\n"
fail = (x)-> stderr.write "#{x}\n"; process.exit()
peek = ()->
  args = (x for x in arguments)
  x = args.pop()
  while args.length
    n = args.shift()
    stderr.write "#{n}: "
  stderr.write "#{JSON.stringify x}\n"; x

php = null
inBody = null
refcoffee = true
includeChunks = true

while args.length > 0 and /^--/.test (arg = args[0])
  if arg is '--php'
    args.shift()
    php = true
  else if arg is '--body'
    args.shift()
    inBody = true
  else if arg is '--refcoffee'
    args.shift
    refcoffee = true
  else if arg is '--'
    args.shift()
    break
  else
    break

if args.length is 0
      throw "Usage: #{progname} HTML-FILE >COFFEE-FILE"

require('../html2cup-conv').html2cup {args[0], php, inBody, refcoffee, includeChunks, echo, log}

